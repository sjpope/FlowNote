{% extends 'base.html' %}

{% block content %}
  <div class="note-container">
    <h2 style="text-align: center;">Notes</h2>

    <div class="search-container" style="text-align: center; margin-bottom: 20px;">
      <form action="{% url 'notes:note_search' %}" method="get">
        <input class="search-bar" type="text" name="q" placeholder="Search notes...">
        <button type="submit" class="search-btn">Search</button>
      </form>
    </div>

    <div class="button-container" style="text-align: left; margin-bottom: 20px;">
      <form action="{% url 'notes:auto_group_all' %}" method="post" style="display: inline-block; margin-right: 10px;">
        {% csrf_token %}
        <button type="submit" class="btn btn-secondary">Auto Group All Notes</button>
      </form>
  
      <button onclick="sortNotesAlphabetically()" type="submit" class="btn btn-secondary" style="display: inline-block;">Sort Alphabetically</button>
    </div>

    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    <ul class="notes-list">
      {% for note in notes %}
        <li class="note-item">
          <a href="{% url 'notes:note_detail' note.pk %}" class="note-card">
            <div class="note-content">
              <h3 style="text-decoration: underline;">{{ note.title }}</h3>
              {% if note.summary %}
                {{ note.content|safe }}
              {% else %}
              {{ note.content|safe }}
              {% endif %}
              <p>By: {{ note.owner }}</p>
            </div>
          </a>
        </li>
      {% endfor %}
    </ul>
  </div>

  <script>
    function sortNotesAlphabetically() {
        // Get the container that holds all the notes
        var notesList = document.querySelector('.notes-list');
        
        // Convert the list of notes into an array for sorting
        var notes = Array.from(notesList.children);
    
        // Sort the notes array alphabetically based on the note title
        notes.sort(function(a, b) {
            var titleA = a.querySelector('h3').textContent.toUpperCase(); // ignore upper and lowercase
            var titleB = b.querySelector('h3').textContent.toUpperCase(); // ignore upper and lowercase
            if (titleA < titleB) {
                return -1;
            }
            if (titleA > titleB) {
                return 1;
            }
            
            // titles must be equal
            return 0;
        });
    
        // Remove the existing notes from the DOM
        while (notesList.firstChild) {
            notesList.removeChild(notesList.firstChild);
        }
    
        // Append the sorted notes back into the DOM
        notes.forEach(function(note) {
            notesList.appendChild(note);
        });
    }
    </script>
    
{% endblock %}

<style>
.messages {
  list-style-type: none;
  padding: 0;
  margin: 0;
}

.messages li {
  margin-bottom: 10px;
}

.success {
  color: green;
}

.error {
  color: red;
}

.warning {
  color: orange;
}
</style>
